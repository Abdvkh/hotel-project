var runCKEditorResizeImage;$(document).ready((function(){"use strict";function creatingThumbnails(fileUpload,formOfUpload){if(void 0!==fileUpload){const fileType=fileUpload.type;if("image/jpeg"!==fileType&&"image/png"!==fileType)return formOfUpload.trigger("reset"),void alert(window.gettext("Only JPG and PNG files."));const MAX_SIZE=966,MAX_WIDTH=MAX_SIZE,MAX_HEIGHT=MAX_SIZE,reader=new FileReader,tempImg=new Image;let tempW,tempH;const uploadIndicator=$("img.cke_image_upload_indicator");uploadIndicator.css("display","block"),reader.onload=function(event){tempImg.onload=function(){tempW=tempImg.width,tempH=tempImg.height,tempW>tempH?tempW>MAX_WIDTH&&(tempH=Math.floor(tempH*(MAX_WIDTH/tempW)),tempW=MAX_WIDTH):tempH>MAX_HEIGHT&&(tempW=Math.floor(tempW*MAX_HEIGHT/tempH),tempH=MAX_HEIGHT);const canvas=document.getElementById("cke_temp_canvas"),ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height),canvas.width=tempW,canvas.height=tempH,ctx.drawImage(tempImg,0,0,tempW,tempH);const dataURI=canvas.toDataURL(fileType),imageBlob=function(){const binary=atob(dataURI.split(",")[1]),ab=new ArrayBuffer(binary.length),ia=new Uint8Array(ab);for(let idx=0;idx<binary.length;idx++)ia[idx]=binary.charCodeAt(idx);return new Blob([ab],{type:fileType})}(),tempFormData=new FormData;tempFormData.append("upload",imageBlob,fileUpload.name),$.ajax({type:"POST",url:formOfUpload.attr("action"),data:tempFormData,processData:!1,contentType:!1}).fail((function(){window.console.log(window.gettext("Server Error ???"))})).always((function(){uploadIndicator.css("display","none"),formOfUpload.trigger("reset")}))},tempImg.src=event.target.result},reader.readAsDataURL(fileUpload)}}try{void 0!==window.CKEDITOR&&window.CKEDITOR.on("dialogDefinition",(function(event){const dialogName=event.data.name,dialogDefinition=event.data.definition,MAX_WIDTH=322;if("image"===dialogName){const onOk=dialogDefinition.onOk;dialogDefinition.onOk=function(event){const width=this.getContentElement("info","txtWidth"),height=this.getContentElement("info","txtHeight"),tmpWidth=+width.getValue();tmpWidth>322&&(height.setValue(Math.floor(+height.getValue()*(322/tmpWidth))),width.setValue(322..toString())),onOk&&onOk.apply(this,event)}}})),runCKEditorResizeImage=function(){$(document).on("click","a.cke_dialog_tab_selected",(function(){const $this=$(this),commonParent=$this.parent().parent(),buttonLoadOnServer=commonParent.find("a.cke_dialog_ui_fileButton"),parentOfButton=buttonLoadOnServer.parent(),iframeContents=commonParent.find("td.cke_dialog_ui_vbox_child iframe").contents(),formOfUpload=iframeContents.find("form");let controlAgent=parentOfButton.find("div.cke_control_agent");controlAgent.length>0&&(commonParent.find("tr.cke_info_upload_image").remove(),controlAgent.off("click"),controlAgent.remove()),parentOfButton.css("position","relative"),$(".cke_image_upload_indicator").remove(),parentOfButton.parent().before('<tr><td><img src="/static/djeym/img/loader.gif" class="cke_image_upload_indicator" style="display: none; margin: 20px 0;" alt="upload indicator"></td></tr>'),parentOfButton.parent().after('<tr class="cke_info_upload_image"><td><div>( '+window.gettext("Image size will be optimized to 966 pixels.")+" )</div></td></tr>"),commonParent.find("tr.cke_info_upload_image div").css({margin:"5px 0 10px",color:"#2196F3","font-size":"14px","font-weight":"bold"}),parentOfButton.prepend('<div class="cke_control_agent"></div>'),(controlAgent=parentOfButton.find("div.cke_control_agent")).css({position:"absolute",top:"0",right:"0",bottom:"0",left:"0","z-index":"1",cursor:"pointer"}),controlAgent.on("click",(function(){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return void alert(window.gettext("The File APIs are not fully supported in this browser. Upgrade your browser - http://browsehappy.com/"));const fileUpload=formOfUpload.find('input[name="upload"]')[0].files[0];creatingThumbnails(fileUpload,formOfUpload)}))}))},$("div").is("#djeym-app")||$("div").is("#app")||runCKEditorResizeImage()}catch(err){window.console.log(err)}}));